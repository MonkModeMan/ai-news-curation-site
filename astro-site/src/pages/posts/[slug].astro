---
// src/pages/posts/[slug].astro Ë®ò‰∫ãË©≥Á¥∞„Éö„Éº„Ç∏:GitHubPagesÂØæÂøú
import "../../styles/global.css";
import { getCollection } from "astro:content";

const { slug } = Astro.params;

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const posts = await getCollection("posts");
const post = posts.find((p) => p.slug === slug);
if (!post) throw new Error("Not found");

const base = (Astro.site?.pathname ?? '').replace(/\/$/, '');
---

<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>{post.data.title}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="bg-gray-100 text-gray-800 font-sans px-4 py-6">
    <div class="max-w-3xl mx-auto">

      <!-- ‚úÖ „Çø„Ç§„Éà„É´ -->
      <header class="mb-6">
        <h1 class="text-3xl font-extrabold text-sky-500 mb-2">üì∞ {post.data.title}</h1>
        <p class="text-sm text-gray-500">
          {post.data.pubDate.toLocaleDateString('ja-JP')} ‚Äì {post.data.source}
          {post.data.url && (
            <>
              {' '}
              <a href={post.data.url} target="_blank" rel="noopener noreferrer"
                class="text-sky-500 hover:text-gray-500 no-underline border-b border-transparent hover:border-gray-300 transition">
                ÂÖÉË®ò‰∫ã
              </a>
            </>
          )}
        </p>
      </header>

      <!-- ‚úÖ Êú¨Êñá -->
      <article class="prose prose-sm sm:prose lg:prose-lg max-w-none bg-white rounded-lg shadow p-6">
        {post.body}
      </article>

      <!-- ‚úÖ Êàª„Çã„Éú„Çø„É≥ -->
      <div class="mt-10 text-center">
        <a id="backLink"
          href="#"
          class="inline-block px-4 py-2 border border-sky-600 text-sky-600 rounded hover:bg-gray-100 transition">
          ‚Üê ‰∏ÄË¶ß„Å∏Êàª„Çã
        </a>
      </div>

    </div>

    <!-- ‚úÖ base „ÇíÊ≠£„Åó„ÅèÂüã„ÇÅËæº„ÇÄ -->
    <script id="baseScript" data-base={base}></script>

    <!-- ‚úÖ Êàª„Çã„É™„É≥„ÇØ„ÇíÊ≠£„Åó„ÅèÊßãÁØâ -->
    <script is:inline>
      const base = document.getElementById('baseScript')?.dataset.base || '';
      console.log("‚úÖ base:", base);

      const params = new URL(window.location.href).searchParams;
      const fromPage = params.get("fromPage") || "1";
      const fromSort = params.get("fromSort") || "date";

      const backLink = document.getElementById("backLink");
      if (backLink) {
        backLink.href = `${base}/page/${fromSort}/${fromPage}`;
        console.log("‚úÖ backLink.href:", backLink.href);
      } else {
        console.warn("‚ö†Ô∏è backLink not found");
      }
    </script>
  </body>
</html>